<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">
    <link ref="stylesheet" href="css/custom.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-markdown>## CQRS + ES > CRUD, CQFD</section>
        <section>
            Valentin KASAS<br/>
            <img src="https://media.licdn.com/media/p/3/005/04d/07b/14cc7c4.jpg"/>
        </section>
        <section>
            Damien GOUYETTE<br/>
            <img src="https://media.licdn.com/mpr/mpr/shrinknp_400_400/p/1/000/0e9/088/3af1beb.jpg"/>
        </section>
        <section>
            Hamak.fr
            <img src="/images/hamak.png"/>
        </section>
        <section>
            <section>CRUD traditionnel</section>
            <section>
                Perte d'informations à chaque mise à jour
                <pre><code data-trim data-noescape>
//avant
{
    "firstName" : "John", "lastName" : "DOE",
    <mark>"email" : "john.doe@yahoo.com"</mark> // valeur perdue pour toujours
}

//après
{
    "firstName" : "John", "lastName" : "DOE",
    "email" : "john.doe@gmail.com"
}

</code></pre>
            </section>
        </section>
        <section>
            <section>Rappels</section>
            <section>
                <mark>C</mark>
                ommand
                <mark>Q</mark>
                uery
                <mark>R</mark>
                esponsability
                <mark>S</mark>
                egregation
            </section>
            <section>
                <mark>E</mark>
                vent
                <mark>S</mark>
                ourcing
            </section>
        </section>
        <section>Architecture Technique de Hamak<br/><br/>
            //TODO image architecture réseau
        </section>
        <section>
            <section>
                De la requête HTTP à la commande
                <aside class="notes">
                    Qu'est ce qu'une commande ? <br/>
                    Exemple de commande curl sur l'API
                </aside>
            </section>
            <section>
                Anatomie d'une commande
                <pre>
                    <code data-trim data-noescape>
sealed trait Cmd
sealed trait UserCmd extends Cmd
sealed trait JobCmd extends Cmd

case object DeleteProviderReview extends JobCommand
case class CreateUser(user : User) extends UserCommand
                    </code>
                    </pre>
            </section>
            <section>
                Quid des sagas ?
                <aside class="notes">
                    Pourquoi on ne les a pas utilisé.
                    Citer des cas d'usages qui auraient pu s'y prêter
                </aside>
            </section>
        </section>
        <section>
            <section>
                <section>
                    De la commande aux événements
                </section>

            </section>
            <section>
                Définition d'un Processor
            </section>
            <section>
                Validation 1er niveau (technique)
                <aside class="notes">
                    Json.format + exemple de validation avancées
                </aside>
            </section>
            <section>
                <pre>
                    <code data-trim data-noescape>
implicit val userFormat = Json.format[User]
implicit val jobFormat = Json.format[Job]
                    </code>
                </pre>
            </section>
            <section>
                <pre>
                    <code data-trim data-noescape>
def reviewJsonReader: Reads[Review] = (
  (__ \ 'text).read[String](minLength[String](75)) and
    (__ \ 'title).readNullable[String] and
    (__ \ 'punctuality).read[Int](min(1) keepAnd max(5)))
    //to continue
                    </code>
                </pre>
            </section>
            <section>
                Validation métier
                <aside class="notes">
                    Validation d'une commande, réutilisation des contraintes,
                </aside>
            </section>


        </section>
        <section>Application de l’event Event Handler</section>
        <section>
            Utilisation des events ?
            <aside class="notes">
                Statistiques
                Résolutation des incidents
            </aside>
        </section>
        <section>
            Akka à la rescousse
            <aside class="notes">
                Akka
                Akka-persistence
                Akka-cluster
            </aside>
        </section>
        <section>
            La prod 2 ans plus tard
            <aside class="notes">
                Charge
                Log et timeout sur les asks
                Procédure de MEP
                Comment vieillissent les events, évolutions des events existants et ajout
            </aside>
        </section>
        <section>Conclusion</section>
        <section>
            ¿ Questions ?<br/>
            <img src="https://media.giphy.com/media/5XRB3Ay93FZw4/giphy.gif"/>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        history: true,
        slideNumber: true,


        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            {src: 'plugin/markdown/marked.js'},
            {src: 'plugin/markdown/markdown.js'},
            {src: 'plugin/notes/notes.js', async: true},
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            }
        ]
    });
</script>
</body>
</html>
